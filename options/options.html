<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tana Web Clipper Settings</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Tana Web Clipper Settings</h1>
      <p class="subtitle">Configure your Tana Local API integration</p>
    </header>

    <main>
      <!-- Connection Section -->
      <section class="section">
        <h2>Connection</h2>
        <p class="help-text">
          Requires Tana Desktop with "Local API/MCP server (Alpha)" enabled in Tana Labs.
          Generate a Personal Access Token in Tana Desktop settings.
        </p>
        <div class="form-group">
          <label for="access-token">Personal Access Token</label>
          <div class="input-with-button">
            <input type="password" id="access-token" placeholder="Enter your Tana Personal Access Token">
            <button type="button" id="toggle-token" class="btn btn-secondary btn-small">Show</button>
          </div>
        </div>
        <div class="connection-status-row">
          <span id="connection-dot" class="connection-dot disconnected"></span>
          <span id="connection-text" class="connection-text">Not connected</span>
        </div>
        <div class="form-group button-row">
          <button type="button" id="connect-btn" class="btn btn-primary">
            Connect to Tana
          </button>
          <button type="button" id="test-connection" class="btn btn-secondary">
            Test Connection
          </button>
          <span id="connection-status" class="status-inline"></span>
        </div>
      </section>

      <!-- Workspace Section -->
      <section class="section" id="workspace-section" style="display: none;">
        <h2>Workspace</h2>
        <div class="form-group">
          <label for="workspace-select">Select workspace</label>
          <div class="input-with-button">
            <select id="workspace-select">
              <option value="">Loading...</option>
            </select>
            <button type="button" id="refresh-workspaces" class="btn btn-secondary btn-small" title="Refresh workspaces">Refresh</button>
          </div>
        </div>
      </section>

      <!-- Tags Section -->
      <section class="section" id="tags-section" style="display: none;">
        <h2>Tags for Clipping</h2>
        <p class="help-text">
          Select which tags are available in the popup dropdown when clipping.
        </p>
        <div class="form-group">
          <div class="input-with-button">
            <input type="text" id="tag-filter" placeholder="Filter tags...">
            <button type="button" id="refresh-tags" class="btn btn-secondary btn-small" title="Refresh tags">Refresh</button>
          </div>
        </div>
        <div id="tags-list" class="tags-list">
          <div class="tags-loading">Loading tags...</div>
        </div>
      </section>

      <!-- Field Mappings Section -->
      <section class="section" id="field-mappings-section" style="display: none;">
        <h2>Field Mappings</h2>
        <p class="help-text">
          Map extracted metadata to fields on your selected tags. Fields are auto-detected from tag schemas.
        </p>

        <div id="field-mappings-container">
          <!-- Populated dynamically per selected tag -->
        </div>
      </section>

      <!-- Keyboard Shortcut -->
      <section class="section">
        <h2>Keyboard Shortcut</h2>
        <p class="help-text">
          Press <kbd id="shortcut-display">Ctrl+Shift+T</kbd> to quickly clip the current page.
        </p>
        <p class="help-text">
          To change the shortcut, visit <a href="#" id="shortcuts-link">chrome://extensions/shortcuts</a>
        </p>
      </section>

      <!-- Save Button -->
      <div class="actions">
        <button type="button" id="save-settings" class="btn btn-primary">
          Save Settings
        </button>
        <span id="save-status" class="status-inline"></span>
      </div>
    </main>
  </div>

  <script src="options.js" type="module"></script>
</body>
</html>
